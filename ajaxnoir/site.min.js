/*! ajaxnoir 2016-04-25 */
function Login(a){var b=$(a);b.submit(function(c){c.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:b.serialize(),method:"POST",success:function(b){var c=parse_json(b);c.ok?window.location.assign("./"):$(a+" .message").html("<p>"+c.message+"</p>")},error:function(b,c,d){$(a+" .message").html("<p>Error: "+d+"</p>")}})})}function MovieInfo(a,b,c){var d=this;this.sel=a,$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"76799216f240ce4f7346b1b47274323c",query:b,year:c},method:"GET",dataType:"text",success:function(a){var b=parse_json(a);0==b.total_results?$(d.sel).html("<p>No information available</p>"):d.addInfo(b)},error:function(a,b,c){$(d.sel).html("<p>Unable to communicate<br>with themoviedb.org</p>")}})}function parse_json(a){try{var b=$.parseJSON(a)}catch(c){throw"JSON parse error: "+a}return b}function Stars(a){var b=$(a+" table");this.sel=a;for(var c=b.find("tr"),d=1;d<c.length;d++)for(var e=$(c.get(d)),f=e.find('input[name="id"]').val(),g=e.find("img"),h=0;h<g.length;h++){var i=$(g.get(h));this.installListener(e,i,f,h+1)}}MovieInfo.prototype.addInfo=function(a){var b=$(this.sel),c="http://image.tmdb.org/t/p/w500/"+a.results[0].poster_path,d="<ul>";d+='<li><a href=""><img src="images/info.png"></a>',d+="<div><p>Title: "+a.results[0].title+"</p>",d+="<p>Release Date: "+a.results[0].release_date+"</p>",d+="<p>Vote average: "+a.results[0].vote_average+"</p>",d+="<p>Vote count: "+a.results[0].vote_count+"</p>",d+="</div></li>",d+='<li><a href=""><img src="images/plot.png"></a>',d+="<div>",d+="<p>"+a.results[0].overview+"</p></div></li>",null!==a.results[0].poster_path&&(d+='<li><a href=""><img src="images/poster.png"></a>',d+="<div>",d+='<p class="poster"><img src="'+c+'">',d+="</p></div>",d+="</li>"),d+="</ul>",b.html(d);for(var e=b.find("a"),f=0;f<e.length;f++){var g=$(e.get(f));this.installListener(g,f)}this.showInfo(0)},MovieInfo.prototype.installListener=function(a,b){var c=this;a.click(function(a){a.preventDefault(),c.showInfo(b)})},MovieInfo.prototype.showInfo=function(a){for(var b=$(this.sel).find("li"),c=0;c<b.length;c++){var d=$(b.get(c));c==a?(d.find("a").css("opacity","1.0"),d.find("div").fadeIn(1e3)):(d.find("a").css("opacity","0.3"),d.find("div").fadeOut(1e3))}},Stars.prototype.installListener=function(a,b,c,d){var e=this;b.click(function(){$.ajax({url:"post/stars.php",data:{id:c,rating:d},method:"POST",success:function(b){var c=parse_json(b);c.ok?($(".table").html(c.table),e.update(a,d),new Stars("form"),e.message("<p>Successfully updated</p>")):e.message("<p>Update failed</p>")},error:function(a,b,c){e.message("<p>Error: "+c+"</p>")}})})},Stars.prototype.update=function(a,b){for(var c=a.find("img"),d=0;d<c.length;d++){var e=$(c.get(d));b>d?e.attr("src","images/star-green.png"):e.attr("src","images/star-gray.png")}var f=a.find("span.num");f.text(""+b+"/10")},Stars.prototype.message=function(a){var b=this;$(this.sel+" .message").html(a),$(this.sel+" .message").show(),setTimeout(function(){$(b.sel+" .message").fadeOut(1e3)},2e3)};